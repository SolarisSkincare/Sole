<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DrShams AI Pro | Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #fcfdfe; color: #1e293b; -webkit-tap-highlight-color: transparent; }
        .tab-active { color: #4f46e5; border-bottom: 3px solid #4f46e5; }
        .card-luxury { background: white; border-radius: 2rem; border: 1px solid #f1f5f9; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05); }
        .ai-gradient { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        .routine-card { background: white; border: 2px solid #6366f1; border-radius: 2.5rem; position: relative; overflow: hidden; }
        .category-pill { transition: all 0.3s ease; cursor: pointer; border: 1px solid #f1f5f9; background: white; }
        .category-pill.active { background: #6366f1; color: white; border-color: #6366f1; }
        .loader { border-top-color: #6366f1; animation: spinner 0.6s linear infinite; }
        @keyframes spinner { to { transform: rotate(360deg); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-100 px-6 py-4 text-center">
        <h1 class="text-2xl font-black text-indigo-600 tracking-tighter inline-flex items-center gap-2">
            DrShams <span class="bg-indigo-600 text-white text-[10px] px-2 py-0.5 rounded-full uppercase tracking-widest">AI PRO</span>
        </h1>
        <nav class="max-w-md mx-auto flex justify-around mt-4 text-sm font-bold text-slate-400">
            <button onclick="switchTab('ai')" id="tab-ai" class="pb-2 px-4 tab-active">Ø§Ù„ØªØ´Ø®ÙŠØµ</button>
            <button onclick="switchTab('products')" id="tab-products" class="pb-2 px-4">Ø§Ù„Ù…Ø®Ø²Ù†</button>
        </nav>
    </header>

    <!-- Tab 1: AI Diagnosis -->
    <section id="view-ai" class="max-w-md mx-auto p-6 space-y-6">
        <div class="card-luxury p-8">
            <textarea id="aiInput" placeholder="ØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù‡Ù†Ø§... (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø´Ø±Ø© Ø¯Ù‡Ù†ÙŠØ© Ù…Ø¹ Ù…Ø³Ø§Ù… ÙˆØ§Ø³Ø¹Ø©)" 
            class="w-full h-28 p-4 bg-slate-50 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-100 border-none text-sm font-bold"></textarea>
            
            <button onclick="askGemini()" class="w-full mt-4 ai-gradient text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3 shadow-lg">
                <i class="fa-solid fa-wand-magic-sparkles"></i> ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ ÙˆØ§Ù‚ØªØ±Ø§Ø­ Ø¹Ù„Ø§Ø¬
            </button>
        </div>

        <div id="aiResponse" class="hidden space-y-4 animate-in fade-in slide-in-from-bottom duration-500">
            <div class="bg-slate-900 p-8 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden">
                <i class="fa-solid fa-quote-right absolute -left-2 -top-2 text-6xl opacity-10"></i>
                <h4 class="text-indigo-400 font-black text-[10px] uppercase mb-2 tracking-widest">Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h4>
                <p id="diagResult" class="text-md font-bold leading-relaxed"></p>
            </div>
            
            <div id="routineCreationArea">
                <h5 class="text-xs font-black text-slate-400 uppercase mb-4 px-2">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø±Ø´Ø­Ø© Ù…Ù† Ù…Ø®Ø²Ù†Ùƒ:</h5>
                <div id="suggestedProducts" class="space-y-3"></div>
                <button onclick="generateRoutineImage()" class="w-full mt-6 bg-emerald-500 text-white py-4 rounded-2xl font-black flex items-center justify-center gap-2 shadow-xl">
                    <i class="fa-solid fa-id-card"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø±ÙˆØªÙŠÙ† Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹
                </button>
            </div>
        </div>
    </section>

    <!-- Tab 2: Products Management -->
    <section id="view-products" class="max-w-md mx-auto p-6 hidden">
        <div class="flex justify-between items-center mb-6 px-2">
            <h2 class="text-xl font-black text-slate-800 tracking-tight">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</h2>
            <button onclick="openModal()" class="w-10 h-10 ai-gradient text-white rounded-xl flex items-center justify-center shadow-md"><i class="fa-solid fa-plus"></i></button>
        </div>

        <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar px-2">
            <span onclick="filterProds('Ø§Ù„ÙƒÙ„')" class="category-pill active whitespace-nowrap px-5 py-2 rounded-full text-xs font-bold shadow-sm">Ø§Ù„ÙƒÙ„</span>
            <span onclick="filterProds('ØºØ³ÙˆÙ„Ø§Øª')" class="category-pill whitespace-nowrap px-5 py-2 rounded-full text-xs font-bold shadow-sm">ØºØ³ÙˆÙ„Ø§Øª</span>
            <span onclick="filterProds('ÙƒØ±ÙŠÙ…Ø§Øª')" class="category-pill whitespace-nowrap px-5 py-2 rounded-full text-xs font-bold shadow-sm">ÙƒØ±ÙŠÙ…Ø§Øª</span>
            <span onclick="filterProds('Ù…Ø±Ø·Ø¨Ø§Øª')" class="category-pill whitespace-nowrap px-5 py-2 rounded-full text-xs font-bold shadow-sm">Ù…Ø±Ø·Ø¨Ø§Øª</span>
            <span onclick="filterProds('Ù…ÙƒÙ…Ù„Ø§Øª')" class="category-pill whitespace-nowrap px-5 py-2 rounded-full text-xs font-bold shadow-sm">Ù…ÙƒÙ…Ù„Ø§Øª</span>
        </div>

        <div id="prodDisplay" class="space-y-3 mt-4"></div>
    </section>

    <!-- Routine Card Preview Modal -->
    <div id="routineModal" class="fixed inset-0 bg-white z-[100] hidden overflow-y-auto p-6">
        <div class="max-w-md mx-auto">
            <div class="flex justify-between items-center mb-6">
                <button onclick="closeRoutine()" class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                <span class="font-black text-xs text-slate-400">Ù‚Ù… Ø¨ØªØµÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ÙˆØªÙŠÙ†</span>
            </div>
            
            <!-- THE ACTUAL CARD -->
            <div id="finalCard" class="routine-card p-10 bg-white">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h2 class="text-3xl font-black text-indigo-600">DrShams</h2>
                        <p class="text-[10px] font-bold text-slate-400 tracking-widest uppercase">Skin Care Routine</p>
                    </div>
                    <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white"><i class="fa-solid fa-leaf"></i></div>
                </div>

                <div class="space-y-6">
                    <div id="cardContent" class="space-y-4">
                        <!-- Products will be listed here -->
                    </div>
                    
                    <div class="pt-6 border-t border-slate-100 mt-8">
                        <p class="text-[10px] font-black text-slate-300 uppercase mb-1">Ù…Ù„Ø§Ø­Ø¸Ø© Ø·Ø¨ÙŠØ©</p>
                        <p class="text-xs text-slate-600 font-bold leading-relaxed italic">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø±ÙˆØªÙŠÙ† ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬. ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ ØªØ­Ø³Ø³ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆÙ‚Ù ÙÙˆØ±Ø§Ù‹.</p>
                    </div>
                </div>

                <div class="mt-10 text-center">
                    <p class="text-[10px] font-black text-indigo-200">ØµÙ…Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¯. Ø´Ù…Ø³ Ø§Ù„Ø°ÙƒÙŠ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="prodModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden z-[60] flex items-end p-6">
        <div class="bg-white w-full max-w-md mx-auto rounded-[3rem] p-8 shadow-2xl animate-in slide-in-from-bottom">
            <h3 class="text-xl font-black mb-6">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</h3>
            <div class="space-y-4">
                <input type="text" id="pTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ (Ù…Ø«Ø§Ù„: ØºØ³ÙˆÙ„ Ø³ÙŠØ±Ø§ÙÙŠ)" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-sm">
                <select id="pCat" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-sm text-indigo-600">
                    <option value="ØºØ³ÙˆÙ„Ø§Øª">ØºØ³ÙˆÙ„Ø§Øª</option>
                    <option value="ÙƒØ±ÙŠÙ…Ø§Øª">ÙƒØ±ÙŠÙ…Ø§Øª</option>
                    <option value="Ù…Ø±Ø·Ø¨Ø§Øª">Ù…Ø±Ø·Ø¨Ø§Øª</option>
                    <option value="Ù…ÙƒÙ…Ù„Ø§Øª">Ù…ÙƒÙ…Ù„Ø§Øª</option>
                </select>
                <textarea id="pTags" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø­Ø¨ÙˆØ¨ØŒ Ø¯Ù‡Ù†ÙŠØ©ØŒ ØªÙØªÙŠØ­...)" class="w-full p-4 bg-slate-50 rounded-2xl outline-none h-24 text-sm font-bold"></textarea>
                <button onclick="addProduct()" class="w-full ai-gradient text-white py-5 rounded-[1.5rem] font-black shadow-lg">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
                <button onclick="closeModal()" class="w-full py-2 text-slate-300 font-bold text-xs uppercase">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let products = JSON.parse(localStorage.getItem('drshams_prods_final')) || [];
        let selectedForRoutine = [];
        let currentFilter = 'Ø§Ù„ÙƒÙ„';

        function switchTab(tab) {
            document.getElementById('view-ai').classList.toggle('hidden', tab !== 'ai');
            document.getElementById('view-products').classList.toggle('hidden', tab !== 'products');
            document.getElementById('tab-ai').classList.toggle('tab-active', tab === 'ai');
            document.getElementById('tab-products').classList.toggle('tab-active', tab === 'products');
        }

        function openModal() { document.getElementById('prodModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('prodModal').classList.add('hidden'); }

        function addProduct() {
            const title = document.getElementById('pTitle').value;
            const category = document.getElementById('pCat').value;
            const tags = document.getElementById('pTags').value;
            if(!title) return;
            products.push({ title, category, tags, id: Date.now() });
            localStorage.setItem('drshams_prods_final', JSON.stringify(products));
            renderProducts();
            closeModal();
            document.getElementById('pTitle').value = '';
            document.getElementById('pTags').value = '';
        }

        function deleteProduct(id) {
            products = products.filter(p => p.id !== id);
            localStorage.setItem('drshams_prods_final', JSON.stringify(products));
            renderProducts();
        }

        function renderProducts() {
            const container = document.getElementById('prodDisplay');
            container.innerHTML = '';
            const filtered = currentFilter === 'Ø§Ù„ÙƒÙ„' ? products : products.filter(p => p.category === currentFilter);
            filtered.forEach(p => {
                container.innerHTML += `
                    <div class="card-luxury p-5 flex justify-between items-center animate-in fade-in slide-in-from-left">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-xs">ğŸ§ª</div>
                            <div>
                                <h4 class="font-black text-slate-800 text-sm">${p.title}</h4>
                                <span class="text-[8px] font-black text-indigo-400 uppercase tracking-widest">${p.category}</span>
                            </div>
                        </div>
                        <button onclick="deleteProduct(${p.id})" class="text-rose-200"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                `;
            });
        }

        function filterProds(cat) {
            currentFilter = cat;
            document.querySelectorAll('.category-pill').forEach(el => el.classList.toggle('active', el.innerText === cat));
            renderProducts();
        }

        async function askGemini() {
            const prompt = document.getElementById('aiInput').value;
            if(!prompt) return;

            const responseArea = document.getElementById('aiResponse');
            const diagResult = document.getElementById('diagResult');
            const suggDiv = document.getElementById('suggestedProducts');

            responseArea.classList.remove('hidden');
            diagResult.innerHTML = '<div class="loader w-6 h-6 border-2 border-white rounded-full mx-auto"></div>';
            suggDiv.innerHTML = '';
            selectedForRoutine = [];

            const systemPrompt = `Ø£Ù†Øª Ø·Ø¨ÙŠØ¨ Ø®Ø¨ÙŠØ±. Ø­Ù„Ù„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ£Ø¹Ø·Ù ØªØ´Ø®ÙŠØµØ§Ù‹ Ø¯Ù‚ÙŠÙ‚Ø§Ù‹ ÙˆÙ…Ø®ØªØµØ±Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.`;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                diagResult.innerText = text;

                // Ø±Ø¨Ø· Ø°ÙƒÙŠ
                const found = products.filter(p => {
                    const tags = p.tags.split('ØŒ').concat(p.tags.split(' '));
                    return tags.some(t => t.length > 2 && (prompt.includes(t) || text.includes(t)));
                });

                if(found.length > 0) {
                    found.forEach(p => {
                        suggDiv.innerHTML += `
                            <div class="p-4 bg-white border border-slate-100 rounded-2xl flex justify-between items-center shadow-sm">
                                <span class="font-bold text-sm text-slate-700">${p.title}</span>
                                <input type="checkbox" onchange="toggleSelection('${p.title}', '${p.category}', this.checked)" class="w-6 h-6 accent-indigo-600">
                            </div>
                        `;
                    });
                } else {
                    suggDiv.innerHTML = '<p class="text-xs text-slate-400 italic px-2">Ù„Ù… Ù†Ø¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø© ÙÙŠ Ù…Ø®Ø²Ù†Ùƒ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©.</p>';
                }
            } catch (e) {
                diagResult.innerText = "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.";
            }
        }

        function toggleSelection(title, category, isChecked) {
            if(isChecked) selectedForRoutine.push({title, category});
            else selectedForRoutine = selectedForRoutine.filter(item => item.title !== title);
        }

        function generateRoutineImage() {
            if(selectedForRoutine.length === 0) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }
            const container = document.getElementById('cardContent');
            container.innerHTML = '';

            selectedForRoutine.forEach(item => {
                container.innerHTML += `
                    <div class="flex items-center gap-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                        <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-xs font-black">
                            ${item.category === 'ØºØ³ÙˆÙ„Ø§Øª' ? 'ğŸš¿' : item.category === 'ÙƒØ±ÙŠÙ…Ø§Øª' ? 'ğŸ§´' : 'ğŸ’Š'}
                        </div>
                        <div>
                            <h4 class="font-black text-slate-800 text-sm">${item.title}</h4>
                            <p class="text-[9px] font-bold text-indigo-500 uppercase tracking-widest">${item.category}</p>
                        </div>
                    </div>
                `;
            });

            document.getElementById('routineModal').classList.remove('hidden');
        }

        function closeRoutine() { document.getElementById('routineModal').classList.add('hidden'); }

        renderProducts();
    </script>
</body>
</html>

